{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/wellness-journal-app%20%281%29/lib/mongodb.ts"],"sourcesContent":["import mongoose from \"mongoose\"\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\"Please define the MONGODB_URI environment variable inside .env.local\")\r\n}\r\n\r\ninterface Cached {\r\n  conn: typeof mongoose | null\r\n  promise: Promise<typeof mongoose> | null\r\n}\r\n\r\nlet cached: Cached = {\r\n  conn: null,\r\n  promise: null,\r\n}\r\n\r\nexport async function connectToDatabase() {\r\n  if (cached.conn) {\r\n    console.log(\"Using cached MongoDB connection\")\r\n    return cached.conn\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    console.log(\"Creating new MongoDB connection to:\", MONGODB_URI?.split(\"@\")[1] || \"unknown\")\r\n    \r\n    cached.promise = mongoose.connect(MONGODB_URI!, {\r\n      retryWrites: true,\r\n      w: \"majority\",\r\n    }).then((mongoose) => {\r\n      console.log(\"MongoDB connected successfully\")\r\n      return mongoose\r\n    }).catch((error) => {\r\n      console.error(\"MongoDB connection failed:\", error)\r\n      cached.promise = null\r\n      throw error\r\n    })\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise\r\n  } catch (e) {\r\n    cached.promise = null\r\n    console.error(\"Failed to establish cached connection:\", e)\r\n    throw e\r\n  }\r\n\r\n  return cached.conn\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAOA,IAAI,SAAiB;IACnB,MAAM;IACN,SAAS;AACX;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE;QACf,QAAQ,GAAG,CAAC;QACZ,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,QAAQ,GAAG,CAAC,uCAAuC,aAAa,MAAM,IAAI,CAAC,EAAE,IAAI;QAEjF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAc;YAC9C,aAAa;YACb,GAAG;QACL,GAAG,IAAI,CAAC,CAAC;YACP,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,GAAG,KAAK,CAAC,CAAC;YACR,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,OAAO,OAAO,GAAG;YACjB,MAAM;QACR;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,0CAA0C;QACxD,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB"}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///D:/wellness-journal-app%20%281%29/lib/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document, PreSaveMiddlewareFunction } from \"mongoose\"\r\nimport bcrypt from \"bcryptjs\"\r\n\r\nexport interface IUser extends Document {\r\n  email: string\r\n  password: string\r\n  name?: string\r\n  avatar?: string\r\n  createdAt: Date\r\n  updatedAt: Date\r\n  comparePassword(password: string): Promise<boolean>\r\n}\r\n\r\nconst userSchema = new Schema<IUser>(\r\n  {\r\n    email: {\r\n      type: String,\r\n      required: true,\r\n      unique: true,\r\n      lowercase: true,\r\n      trim: true,\r\n      match: [/^\\w+([.-]?\\w+)*@\\w+([.-]?\\w+)*(\\.\\w{2,3})+$/, \"Please provide a valid email\"],\r\n    },\r\n    password: {\r\n      type: String,\r\n      required: true,\r\n      minlength: 6,\r\n      select: false, // Don't return password by default\r\n    },\r\n    name: {\r\n      type: String,\r\n      default: \"User\",\r\n    },\r\n    avatar: {\r\n      type: String,\r\n      default: null,\r\n    },\r\n  },\r\n  {\r\n    timestamps: true,\r\n  }\r\n)\r\n\r\n// Hash password before saving - using async/await pattern\r\nuserSchema.pre<IUser>(\"save\", async function (this: IUser) {\r\n  // Only hash if password has been modified\r\n  if (!this.isModified(\"password\")) {\r\n    return\r\n  }\r\n\r\n  try {\r\n    console.log(\"Pre-save: Hashing password for user:\", this.email)\r\n    const salt = await bcrypt.genSalt(10)\r\n    const hash = await bcrypt.hash(this.password, salt)\r\n    this.password = hash\r\n    console.log(\"Pre-save: Password hashed successfully\")\r\n  } catch (error) {\r\n    console.error(\"Pre-save: Password hashing failed:\", error)\r\n    throw error\r\n  }\r\n})\r\n\r\n// Method to compare password\r\nuserSchema.methods.comparePassword = async function (this: IUser, password: string) {\r\n  return bcrypt.compare(password, this.password)\r\n}\r\n\r\nexport default mongoose.models.User || mongoose.model<IUser>(\"User\", userSchema)\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAYA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,OAAO;QACL,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YAAC;YAA+C;SAA+B;IACxF;IACA,UAAU;QACR,MAAM;QACN,UAAU;QACV,WAAW;QACX,QAAQ;IACV;IACA,MAAM;QACJ,MAAM;QACN,SAAS;IACX;IACA,QAAQ;QACN,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,0DAA0D;AAC1D,WAAW,GAAG,CAAQ,QAAQ;IAC5B,0CAA0C;IAC1C,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa;QAChC;IACF;IAEA,IAAI;QACF,QAAQ,GAAG,CAAC,wCAAwC,IAAI,CAAC,KAAK;QAC9D,MAAM,OAAO,MAAM,8IAAM,CAAC,OAAO,CAAC;QAClC,MAAM,OAAO,MAAM,8IAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;QAC9C,IAAI,CAAC,QAAQ,GAAG;QAChB,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,MAAM;IACR;AACF;AAEA,6BAA6B;AAC7B,WAAW,OAAO,CAAC,eAAe,GAAG,eAA6B,QAAgB;IAChF,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU,IAAI,CAAC,QAAQ;AAC/C;uCAEe,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file:///D:/wellness-journal-app%20%281%29/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { connectToDatabase } from \"@/lib/mongodb\"\r\nimport User from \"@/lib/models/User\"\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    console.log(\"Login request received\")\r\n    \r\n    await connectToDatabase()\r\n    console.log(\"Database connected successfully\")\r\n\r\n    const { email, password } = await req.json()\r\n    console.log(\"Login attempt for email:\", email)\r\n\r\n    // Validation\r\n    if (!email || !password) {\r\n      return NextResponse.json({ error: \"Email and password are required\" }, { status: 400 })\r\n    }\r\n\r\n    // Find user and check password\r\n    const user = await User.findOne({ email }).select(\"+password\")\r\n    console.log(\"User found:\", !!user)\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ error: \"Invalid email or password\" }, { status: 401 })\r\n    }\r\n\r\n    const isPasswordValid = await user.comparePassword(password)\r\n    console.log(\"Password valid:\", isPasswordValid)\r\n\r\n    if (!isPasswordValid) {\r\n      return NextResponse.json({ error: \"Invalid email or password\" }, { status: 401 })\r\n    }\r\n\r\n    // Create response with user data (excluding password)\r\n    const userWithoutPassword = user.toObject()\r\n    delete (userWithoutPassword as any).password\r\n\r\n    console.log(\"Login successful for user:\", email)\r\n\r\n    return NextResponse.json(\r\n      {\r\n        message: \"Login successful\",\r\n        user: userWithoutPassword,\r\n      },\r\n      { status: 200 }\r\n    )\r\n  } catch (error) {\r\n    console.error(\"Login error:\", error)\r\n    if (error instanceof Error) {\r\n      console.error(\"Error details:\", error.message)\r\n      console.error(\"Error stack:\", error.stack)\r\n    }\r\n    return NextResponse.json({ error: \"Internal server error\", details: String(error) }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,MAAM,IAAA,qIAAiB;QACvB,QAAQ,GAAG,CAAC;QAEZ,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAC1C,QAAQ,GAAG,CAAC,4BAA4B;QAExC,aAAa;QACb,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkC,GAAG;gBAAE,QAAQ;YAAI;QACvF;QAEA,+BAA+B;QAC/B,MAAM,OAAO,MAAM,kIAAI,CAAC,OAAO,CAAC;YAAE;QAAM,GAAG,MAAM,CAAC;QAClD,QAAQ,GAAG,CAAC,eAAe,CAAC,CAAC;QAE7B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,MAAM,kBAAkB,MAAM,KAAK,eAAe,CAAC;QACnD,QAAQ,GAAG,CAAC,mBAAmB;QAE/B,IAAI,CAAC,iBAAiB;YACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,sDAAsD;QACtD,MAAM,sBAAsB,KAAK,QAAQ;QACzC,OAAO,AAAC,oBAA4B,QAAQ;QAE5C,QAAQ,GAAG,CAAC,8BAA8B;QAE1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,MAAM;QACR,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,IAAI,iBAAiB,OAAO;YAC1B,QAAQ,KAAK,CAAC,kBAAkB,MAAM,OAAO;YAC7C,QAAQ,KAAK,CAAC,gBAAgB,MAAM,KAAK;QAC3C;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAyB,SAAS,OAAO;QAAO,GAAG;YAAE,QAAQ;QAAI;IACrG;AACF"}}]
}