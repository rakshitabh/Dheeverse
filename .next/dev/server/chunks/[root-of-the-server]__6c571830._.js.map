{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/wellness-journal-app%20%281%29/app/api/user/archive-pin/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { MongoClient } from \"mongodb\"\r\n\r\nconst mongoUri = process.env.MONGODB_URI || \"mongodb://localhost:27017\"\r\nconst dbName = \"wellness_journal\"\r\nconst collectionName = \"user_settings\"\r\n\r\nasync function connectToDatabase() {\r\n  const client = await MongoClient.connect(mongoUri)\r\n  const db = client.db(dbName)\r\n  return { client, db }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { db, client } = await connectToDatabase()\r\n\r\n    // Get user ID from session or request (you'll need to implement proper authentication)\r\n    // For now, using a default user\r\n    const userId = request.headers.get(\"x-user-id\") || \"default-user\"\r\n\r\n    const settings = await db.collection(collectionName).findOne({ userId })\r\n\r\n    await client.close()\r\n\r\n    if (!settings || !settings.archivePin) {\r\n      return NextResponse.json({ pin: null }, { status: 200 })\r\n    }\r\n\r\n    return NextResponse.json({ pin: settings.archivePin }, { status: 200 })\r\n  } catch (error) {\r\n    console.error(\"Error fetching archive PIN:\", error)\r\n    return NextResponse.json({ error: \"Failed to fetch archive PIN\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { pin } = await request.json()\r\n\r\n    if (!pin || pin.length !== 4) {\r\n      return NextResponse.json({ error: \"PIN must be 4 digits\" }, { status: 400 })\r\n    }\r\n\r\n    const { db, client } = await connectToDatabase()\r\n\r\n    // Get user ID from session or request\r\n    const userId = request.headers.get(\"x-user-id\") || \"default-user\"\r\n\r\n    const result = await db.collection(collectionName).updateOne(\r\n      { userId },\r\n      { $set: { archivePin: pin, updatedAt: new Date() } },\r\n      { upsert: true }\r\n    )\r\n\r\n    await client.close()\r\n\r\n    return NextResponse.json({ success: true, message: \"Archive PIN updated\" }, { status: 200 })\r\n  } catch (error) {\r\n    console.error(\"Error updating archive PIN:\", error)\r\n    return NextResponse.json({ error: \"Failed to update archive PIN\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: NextRequest) {\r\n  try {\r\n    const { db, client } = await connectToDatabase()\r\n\r\n    // Get user ID from session or request\r\n    const userId = request.headers.get(\"x-user-id\") || \"default-user\"\r\n\r\n    await db.collection(collectionName).updateOne(\r\n      { userId },\r\n      { $unset: { archivePin: \"\" } }\r\n    )\r\n\r\n    await client.close()\r\n\r\n    return NextResponse.json({ success: true, message: \"Archive PIN removed\" }, { status: 200 })\r\n  } catch (error) {\r\n    console.error(\"Error deleting archive PIN:\", error)\r\n    return NextResponse.json({ error: \"Failed to delete archive PIN\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,WAAW,QAAQ,GAAG,CAAC,WAAW,IAAI;AAC5C,MAAM,SAAS;AACf,MAAM,iBAAiB;AAEvB,eAAe;IACb,MAAM,SAAS,MAAM,sHAAW,CAAC,OAAO,CAAC;IACzC,MAAM,KAAK,OAAO,EAAE,CAAC;IACrB,OAAO;QAAE;QAAQ;IAAG;AACtB;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,MAAM;QAE7B,uFAAuF;QACvF,gCAAgC;QAChC,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB;QAEnD,MAAM,WAAW,MAAM,GAAG,UAAU,CAAC,gBAAgB,OAAO,CAAC;YAAE;QAAO;QAEtE,MAAM,OAAO,KAAK;QAElB,IAAI,CAAC,YAAY,CAAC,SAAS,UAAU,EAAE;YACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,KAAK;YAAK,GAAG;gBAAE,QAAQ;YAAI;QACxD;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,KAAK,SAAS,UAAU;QAAC,GAAG;YAAE,QAAQ;QAAI;IACvE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,QAAQ,IAAI;QAElC,IAAI,CAAC,OAAO,IAAI,MAAM,KAAK,GAAG;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,MAAM;QAE7B,sCAAsC;QACtC,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB;QAEnD,MAAM,SAAS,MAAM,GAAG,UAAU,CAAC,gBAAgB,SAAS,CAC1D;YAAE;QAAO,GACT;YAAE,MAAM;gBAAE,YAAY;gBAAK,WAAW,IAAI;YAAO;QAAE,GACnD;YAAE,QAAQ;QAAK;QAGjB,MAAM,OAAO,KAAK;QAElB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC5F,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+B,GAAG;YAAE,QAAQ;QAAI;IACpF;AACF;AAEO,eAAe,OAAO,OAAoB;IAC/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,MAAM;QAE7B,sCAAsC;QACtC,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB;QAEnD,MAAM,GAAG,UAAU,CAAC,gBAAgB,SAAS,CAC3C;YAAE;QAAO,GACT;YAAE,QAAQ;gBAAE,YAAY;YAAG;QAAE;QAG/B,MAAM,OAAO,KAAK;QAElB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC5F,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+B,GAAG;YAAE,QAAQ;QAAI;IACpF;AACF"}}]
}