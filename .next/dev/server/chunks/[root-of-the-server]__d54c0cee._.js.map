{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/wellness-journal-app%20%281%29/lib/mongodb.ts"],"sourcesContent":["import mongoose from \"mongoose\"\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\"Please define the MONGODB_URI environment variable inside .env.local\")\r\n}\r\n\r\ninterface Cached {\r\n  conn: typeof mongoose | null\r\n  promise: Promise<typeof mongoose> | null\r\n}\r\n\r\nlet cached: Cached = {\r\n  conn: null,\r\n  promise: null,\r\n}\r\n\r\nexport async function connectToDatabase() {\r\n  if (cached.conn) {\r\n    console.log(\"Using cached MongoDB connection\")\r\n    return cached.conn\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    console.log(\"Creating new MongoDB connection to:\", MONGODB_URI?.split(\"@\")[1] || \"unknown\")\r\n    \r\n    cached.promise = mongoose.connect(MONGODB_URI!, {\r\n      retryWrites: true,\r\n      w: \"majority\",\r\n    }).then((mongoose) => {\r\n      console.log(\"MongoDB connected successfully\")\r\n      return mongoose\r\n    }).catch((error) => {\r\n      console.error(\"MongoDB connection failed:\", error)\r\n      cached.promise = null\r\n      throw error\r\n    })\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise\r\n  } catch (e) {\r\n    cached.promise = null\r\n    console.error(\"Failed to establish cached connection:\", e)\r\n    throw e\r\n  }\r\n\r\n  return cached.conn\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAOA,IAAI,SAAiB;IACnB,MAAM;IACN,SAAS;AACX;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE;QACf,QAAQ,GAAG,CAAC;QACZ,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,QAAQ,GAAG,CAAC,uCAAuC,aAAa,MAAM,IAAI,CAAC,EAAE,IAAI;QAEjF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAc;YAC9C,aAAa;YACb,GAAG;QACL,GAAG,IAAI,CAAC,CAAC;YACP,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,GAAG,KAAK,CAAC,CAAC;YACR,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,OAAO,OAAO,GAAG;YACjB,MAAM;QACR;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,0CAA0C;QACxD,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB"}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///D:/wellness-journal-app%20%281%29/lib/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document, PreSaveMiddlewareFunction } from \"mongoose\"\r\nimport bcrypt from \"bcryptjs\"\r\n\r\nexport interface IUser extends Document {\r\n  email: string\r\n  password: string\r\n  name?: string\r\n  avatar?: string\r\n  createdAt: Date\r\n  updatedAt: Date\r\n  comparePassword(password: string): Promise<boolean>\r\n}\r\n\r\nconst userSchema = new Schema<IUser>(\r\n  {\r\n    email: {\r\n      type: String,\r\n      required: true,\r\n      unique: true,\r\n      lowercase: true,\r\n      trim: true,\r\n      match: [/^\\w+([.-]?\\w+)*@\\w+([.-]?\\w+)*(\\.\\w{2,3})+$/, \"Please provide a valid email\"],\r\n    },\r\n    password: {\r\n      type: String,\r\n      required: true,\r\n      minlength: 6,\r\n      select: false, // Don't return password by default\r\n    },\r\n    name: {\r\n      type: String,\r\n      default: \"User\",\r\n    },\r\n    avatar: {\r\n      type: String,\r\n      default: null,\r\n    },\r\n  },\r\n  {\r\n    timestamps: true,\r\n  }\r\n)\r\n\r\n// Hash password before saving - using async/await pattern\r\nuserSchema.pre<IUser>(\"save\", async function (this: IUser) {\r\n  // Only hash if password has been modified\r\n  if (!this.isModified(\"password\")) {\r\n    return\r\n  }\r\n\r\n  try {\r\n    console.log(\"Pre-save: Hashing password for user:\", this.email)\r\n    const salt = await bcrypt.genSalt(10)\r\n    const hash = await bcrypt.hash(this.password, salt)\r\n    this.password = hash\r\n    console.log(\"Pre-save: Password hashed successfully\")\r\n  } catch (error) {\r\n    console.error(\"Pre-save: Password hashing failed:\", error)\r\n    throw error\r\n  }\r\n})\r\n\r\n// Method to compare password\r\nuserSchema.methods.comparePassword = async function (this: IUser, password: string) {\r\n  return bcrypt.compare(password, this.password)\r\n}\r\n\r\nexport default mongoose.models.User || mongoose.model<IUser>(\"User\", userSchema)\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAYA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,OAAO;QACL,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YAAC;YAA+C;SAA+B;IACxF;IACA,UAAU;QACR,MAAM;QACN,UAAU;QACV,WAAW;QACX,QAAQ;IACV;IACA,MAAM;QACJ,MAAM;QACN,SAAS;IACX;IACA,QAAQ;QACN,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,0DAA0D;AAC1D,WAAW,GAAG,CAAQ,QAAQ;IAC5B,0CAA0C;IAC1C,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa;QAChC;IACF;IAEA,IAAI;QACF,QAAQ,GAAG,CAAC,wCAAwC,IAAI,CAAC,KAAK;QAC9D,MAAM,OAAO,MAAM,8IAAM,CAAC,OAAO,CAAC;QAClC,MAAM,OAAO,MAAM,8IAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;QAC9C,IAAI,CAAC,QAAQ,GAAG;QAChB,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,MAAM;IACR;AACF;AAEA,6BAA6B;AAC7B,WAAW,OAAO,CAAC,eAAe,GAAG,eAA6B,QAAgB;IAChF,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU,IAAI,CAAC,QAAQ;AAC/C;uCAEe,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file:///D:/wellness-journal-app%20%281%29/lib/models/OTP.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\"\r\n\r\nexport interface IOTP extends Document {\r\n  email: string\r\n  otp: string\r\n  expiresAt: Date\r\n  verified: boolean\r\n  createdAt: Date\r\n}\r\n\r\nconst otpSchema = new Schema<IOTP>(\r\n  {\r\n    email: {\r\n      type: String,\r\n      required: true,\r\n      lowercase: true,\r\n      trim: true,\r\n    },\r\n    otp: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    expiresAt: {\r\n      type: Date,\r\n      required: true,\r\n      default: () => new Date(Date.now() + 10 * 60 * 1000), // 10 minutes\r\n    },\r\n    verified: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  {\r\n    timestamps: true,\r\n  }\r\n)\r\n\r\n// Delete expired OTPs automatically\r\notpSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 0 })\r\n\r\nexport default mongoose.models.OTP || mongoose.model<IOTP>(\"OTP\", otpSchema)\r\n"],"names":[],"mappings":";;;;AAAA;;AAUA,MAAM,YAAY,IAAI,mHAAM,CAC1B;IACE,OAAO;QACL,MAAM;QACN,UAAU;QACV,WAAW;QACX,MAAM;IACR;IACA,KAAK;QACH,MAAM;QACN,UAAU;IACZ;IACA,WAAW;QACT,MAAM;QACN,UAAU;QACV,SAAS,IAAM,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK;IACjD;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;AAGF,oCAAoC;AACpC,UAAU,KAAK,CAAC;IAAE,WAAW;AAAE,GAAG;IAAE,oBAAoB;AAAE;uCAE3C,oHAAQ,CAAC,MAAM,CAAC,GAAG,IAAI,oHAAQ,CAAC,KAAK,CAAO,OAAO"}},
    {"offset": {"line": 291, "column": 0}, "map": {"version":3,"sources":["file:///D:/wellness-journal-app%20%281%29/lib/email.ts"],"sourcesContent":["import nodemailer from \"nodemailer\"\r\n\r\nconsole.log(\"=== Email Service Initialization ===\")\r\nconsole.log(\"EMAIL_SERVICE:\", process.env.EMAIL_SERVICE)\r\nconsole.log(\"EMAIL_USER:\", process.env.EMAIL_USER)\r\nconsole.log(\"EMAIL_PASS length:\", process.env.EMAIL_PASS?.length || 0)\r\nconsole.log(\"EMAIL_PASS first 5 chars:\", process.env.EMAIL_PASS?.substring(0, 5) || \"NOT SET\")\r\nconsole.log(\"EMAIL_PASS exists:\", !!process.env.EMAIL_PASS)\r\n\r\nlet transporter: any = null\r\nlet verificationChecked = false\r\n\r\nasync function initializeTransporter() {\r\n  if (transporter && verificationChecked) {\r\n    console.log(\"[Cache Hit] Using cached transporter\")\r\n    return transporter\r\n  }\r\n\r\n  try {\r\n    console.log(\"\\n[Init] Creating Nodemailer transporter...\")\r\n    console.log(\"[Init] Service: Gmail\")\r\n    console.log(\"[Init] User:\", process.env.EMAIL_USER)\r\n    console.log(\"[Init] Pass provided:\", !!process.env.EMAIL_PASS)\r\n    \r\n    transporter = nodemailer.createTransport({\r\n      service: process.env.EMAIL_SERVICE || \"gmail\",\r\n      auth: {\r\n        user: process.env.EMAIL_USER,\r\n        pass: process.env.EMAIL_PASS,\r\n      },\r\n    })\r\n\r\n    console.log(\"[Init] Transporter created, verifying SMTP connection...\")\r\n    const verified = await transporter.verify()\r\n    console.log(\"[Init] ✓ SMTP connection verified:\", verified)\r\n    verificationChecked = true\r\n    \r\n    return transporter\r\n  } catch (error) {\r\n    console.error(\"[Init] ✗ Failed to initialize email transporter\")\r\n    console.error(\"[Init] Error type:\", error instanceof Error ? error.constructor.name : typeof error)\r\n    console.error(\"[Init] Error message:\", String(error))\r\n    if (error instanceof Error) {\r\n      console.error(\"[Init] Error code:\", (error as any).code)\r\n      console.error(\"[Init] Error response:\", (error as any).response)\r\n    }\r\n    verificationChecked = true\r\n    throw error\r\n  }\r\n}\r\n\r\nexport interface SendEmailOptions {\r\n  to: string\r\n  subject: string\r\n  html: string\r\n}\r\n\r\nexport async function sendEmail({ to, subject, html }: SendEmailOptions) {\r\n  console.log(\"\\n[Email] === Sending Email ===\")\r\n  console.log(\"[Email] To:\", to)\r\n  console.log(\"[Email] Subject:\", subject)\r\n  \r\n  try {\r\n    console.log(\"[Email] Initializing transporter...\")\r\n    const transporter = await initializeTransporter()\r\n    \r\n    console.log(\"[Email] Transporter ready, sending mail...\")\r\n    const result = await transporter.sendMail({\r\n      from: `\"DheeVerse\" <${process.env.EMAIL_USER}>`,\r\n      to,\r\n      subject,\r\n      html,\r\n    })\r\n    \r\n    console.log(\"[Email] ✓ Email sent successfully!\")\r\n    console.log(\"[Email] Message ID:\", result.messageId)\r\n    return result\r\n  } catch (error) {\r\n    console.error(\"\\n[Email] ✗ Error sending email\")\r\n    console.error(\"[Email] Error type:\", error instanceof Error ? error.constructor.name : typeof error)\r\n    console.error(\"[Email] Error message:\", String(error))\r\n    if (error instanceof Error) {\r\n      console.error(\"[Email] Full error:\", error.message)\r\n      console.error(\"[Email] Error code:\", (error as any).code)\r\n      console.error(\"[Email] Error response:\", (error as any).response)\r\n      if ((error as any).code === 'EAUTH') {\r\n        console.error(\"[Email] ⚠️  AUTHENTICATION ERROR - Check your email credentials in .env.local\")\r\n        console.error(\"[Email]    Email user:\", process.env.EMAIL_USER)\r\n        console.error(\"[Email]    Email pass length:\", process.env.EMAIL_PASS?.length || 0)\r\n      }\r\n    }\r\n    throw error\r\n  }\r\n}\r\n\r\nexport function generateOTP(): string {\r\n  const otp = Math.floor(100000 + Math.random() * 900000).toString()\r\n  console.log(\"Generated OTP:\", otp)\r\n  return otp\r\n}\r\n\r\nexport async function sendOTPEmail(email: string, otp: string) {\r\n  try {\r\n    console.log(\"Preparing OTP email for:\", email)\r\n    \r\n    const html = `\r\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\r\n        <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; color: white; text-align: center; margin-bottom: 30px;\">\r\n          <h1 style=\"margin: 0; font-size: 28px;\">DheeVerse</h1>\r\n          <p style=\"margin: 5px 0 0 0;\">Wellness Journal</p>\r\n        </div>\r\n\r\n        <h2 style=\"color: #333; text-align: center;\">Email Verification</h2>\r\n        <p style=\"color: #666; text-align: center;\">Welcome to DheeVerse Wellness Journal!</p>\r\n        \r\n        <p style=\"color: #333; margin: 30px 0 15px 0;\">Your One-Time Password (OTP) is:</p>\r\n        <div style=\"background-color: #f0f0f0; padding: 30px; border-radius: 8px; text-align: center; margin: 20px 0;\">\r\n          <h1 style=\"color: #667eea; letter-spacing: 3px; margin: 0; font-size: 48px; font-weight: bold;\">${otp}</h1>\r\n        </div>\r\n        \r\n        <p style=\"color: #666; margin: 20px 0;\">\r\n          <strong>This OTP will expire in 10 minutes.</strong>\r\n        </p>\r\n        \r\n        <p style=\"color: #999; font-size: 14px; margin-top: 30px;\">\r\n          If you didn't request this verification, please ignore this email and do not share this OTP with anyone.\r\n        </p>\r\n        \r\n        <hr style=\"border: none; border-top: 1px solid #eee; margin: 30px 0;\" />\r\n        <p style=\"color: #999; font-size: 12px; text-align: center;\">\r\n          This is an automated email. Please do not reply to this message.\r\n        </p>\r\n      </div>\r\n    `\r\n\r\n    const result = await sendEmail({\r\n      to: email,\r\n      subject: \"Your OTP for DheeVerse Wellness Journal - Expires in 10 minutes\",\r\n      html,\r\n    })\r\n    \r\n    console.log(\"OTP email sent successfully to:\", email)\r\n    return result\r\n  } catch (error) {\r\n    console.error(\"Failed to send OTP email:\", error)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport async function sendWelcomeEmail(email: string, name: string) {\r\n  try {\r\n    console.log(\"Preparing welcome email for:\", email)\r\n    \r\n    const html = `\r\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\r\n        <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; color: white; text-align: center; margin-bottom: 30px;\">\r\n          <h1 style=\"margin: 0; font-size: 28px;\">DheeVerse</h1>\r\n          <p style=\"margin: 5px 0 0 0;\">Wellness Journal</p>\r\n        </div>\r\n\r\n        <h2 style=\"color: #333;\">Welcome to DheeVerse, ${name}!</h2>\r\n        <p style=\"color: #666;\">Your account has been successfully verified and created.</p>\r\n        \r\n        <p style=\"color: #333; margin: 30px 0 15px 0;\">Start your wellness journey today!</p>\r\n        \r\n        <div style=\"text-align: center; margin: 30px 0;\">\r\n          <a href=\"${process.env.NEXT_PUBLIC_APP_URL}/journal\" style=\"background-color: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block; font-weight: bold;\">\r\n            Open DheeVerse\r\n          </a>\r\n        </div>\r\n        \r\n        <hr style=\"border: none; border-top: 1px solid #eee; margin: 30px 0;\" />\r\n        <p style=\"color: #999; font-size: 12px; text-align: center;\">\r\n          This is an automated email. Please do not reply to this message.\r\n        </p>\r\n      </div>\r\n    `\r\n\r\n    const result = await sendEmail({\r\n      to: email,\r\n      subject: \"Welcome to DheeVerse Wellness Journal!\",\r\n      html,\r\n    })\r\n    \r\n    console.log(\"Welcome email sent successfully to:\", email)\r\n    return result\r\n  } catch (error) {\r\n    console.error(\"Failed to send welcome email:\", error)\r\n    throw error\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 471, "column": 0}, "map": {"version":3,"sources":["file:///D:/wellness-journal-app%20%281%29/app/api/auth/signup/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { connectToDatabase } from \"@/lib/mongodb\"\r\nimport User from \"@/lib/models/User\"\r\nimport OTP from \"@/lib/models/OTP\"\r\nimport { sendOTPEmail, generateOTP } from \"@/lib/email\"\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    console.log(\"=== Signup Request Started ===\")\r\n    \r\n    const { email, password } = await req.json()\r\n    console.log(\"Signup data received - Email:\", email)\r\n\r\n    // Validation\r\n    if (!email || !password) {\r\n      console.log(\"Validation failed: missing email or password\")\r\n      return NextResponse.json({ error: \"Email and password are required\" }, { status: 400 })\r\n    }\r\n\r\n    if (password.length < 6) {\r\n      console.log(\"Validation failed: password too short\")\r\n      return NextResponse.json({ error: \"Password must be at least 6 characters\" }, { status: 400 })\r\n    }\r\n\r\n    console.log(\"Connecting to database...\")\r\n    await connectToDatabase()\r\n    console.log(\"Database connected successfully\")\r\n\r\n    // Check if user already exists\r\n    console.log(\"Checking if user already exists...\")\r\n    const existingUser = await User.findOne({ email })\r\n    if (existingUser) {\r\n      console.log(\"User already exists:\", email)\r\n      return NextResponse.json({ error: \"Email already registered\" }, { status: 409 })\r\n    }\r\n\r\n    // Create user\r\n    console.log(\"Creating new user...\")\r\n    const user = new User({\r\n      email,\r\n      password,\r\n      name: email.split(\"@\")[0],\r\n    })\r\n\r\n    console.log(\"Saving user to database...\")\r\n    await user.save()\r\n    console.log(\"User saved successfully with ID:\", user._id)\r\n\r\n    // Generate and save OTP\r\n    console.log(\"Generating OTP...\")\r\n    const otp = generateOTP()\r\n    console.log(\"OTP generated:\", otp)\r\n    \r\n    await OTP.deleteMany({ email })\r\n    console.log(\"Old OTPs deleted\")\r\n    \r\n    await OTP.create({\r\n      email,\r\n      otp,\r\n      expiresAt: new Date(Date.now() + 10 * 60 * 1000), // 10 minutes\r\n    })\r\n    console.log(\"OTP saved to database\")\r\n\r\n    // Send OTP email - non-blocking\r\n    console.log(\"Sending OTP email...\")\r\n    let emailSent = false\r\n    let emailError = null\r\n\r\n    try {\r\n      await sendOTPEmail(email, otp)\r\n      emailSent = true\r\n      console.log(\"OTP email sent successfully\")\r\n    } catch (emailErr) {\r\n      emailError = emailErr\r\n      console.error(\"Failed to send OTP email:\", emailErr)\r\n    }\r\n\r\n    // Return success regardless of email status\r\n    if (emailSent) {\r\n      console.log(\"Signup completed successfully with email sent\")\r\n      return NextResponse.json(\r\n        {\r\n          message: \"User registered successfully. OTP sent to email.\",\r\n          userId: user._id,\r\n          email: user.email,\r\n        },\r\n        { status: 201 }\r\n      )\r\n    } else {\r\n      console.log(\"Signup completed but email failed - returning partial success\")\r\n      return NextResponse.json(\r\n        {\r\n          message: \"User created but OTP email could not be sent. Please check your email configuration and try resending OTP.\",\r\n          userId: user._id,\r\n          email: user.email,\r\n          emailError: String(emailError),\r\n        },\r\n        { status: 201 }\r\n      )\r\n    }\r\n  } catch (error) {\r\n    console.error(\"=== Signup Error ===\")\r\n    console.error(\"Error type:\", error instanceof Error ? error.constructor.name : typeof error)\r\n    console.error(\"Error message:\", String(error))\r\n    \r\n    if (error instanceof Error) {\r\n      console.error(\"Error details:\", error.message)\r\n      console.error(\"Error stack:\", error.stack)\r\n    }\r\n    \r\n    return NextResponse.json(\r\n      { \r\n        error: \"Internal server error\",\r\n        message: String(error),\r\n      }, \r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}